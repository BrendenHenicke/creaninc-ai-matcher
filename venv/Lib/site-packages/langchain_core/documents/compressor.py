"""Document compressor."""

from __future__ import annotations

from abc import ABC, abstractmethod
<<<<<<< HEAD
from typing import TYPE_CHECKING, Optional
=======
from typing import TYPE_CHECKING
>>>>>>> 10771d2d (Initial commit for Crean AI Matcher full app)

from pydantic import BaseModel

from langchain_core.runnables import run_in_executor

if TYPE_CHECKING:
    from collections.abc import Sequence

    from langchain_core.callbacks import Callbacks
    from langchain_core.documents import Document


class BaseDocumentCompressor(BaseModel, ABC):
    """Base class for document compressors.

<<<<<<< HEAD
    This abstraction is primarily used for
    post-processing of retrieved documents.

    Documents matching a given query are first retrieved.
    Then the list of documents can be further processed.

    For example, one could re-rank the retrieved documents
    using an LLM.

    **Note** users should favor using a RunnableLambda
    instead of sub-classing from this interface.
=======
    This abstraction is primarily used for post-processing of retrieved documents.

    Documents matching a given query are first retrieved.

    Then the list of documents can be further processed.

    For example, one could re-rank the retrieved documents using an LLM.

    !!! note
        Users should favor using a RunnableLambda instead of sub-classing from this
        interface.

>>>>>>> 10771d2d (Initial commit for Crean AI Matcher full app)
    """

    @abstractmethod
    def compress_documents(
        self,
        documents: Sequence[Document],
        query: str,
<<<<<<< HEAD
        callbacks: Optional[Callbacks] = None,
=======
        callbacks: Callbacks | None = None,
>>>>>>> 10771d2d (Initial commit for Crean AI Matcher full app)
    ) -> Sequence[Document]:
        """Compress retrieved documents given the query context.

        Args:
            documents: The retrieved documents.
            query: The query context.
            callbacks: Optional callbacks to run during compression.

        Returns:
            The compressed documents.
<<<<<<< HEAD
=======

>>>>>>> 10771d2d (Initial commit for Crean AI Matcher full app)
        """

    async def acompress_documents(
        self,
        documents: Sequence[Document],
        query: str,
<<<<<<< HEAD
        callbacks: Optional[Callbacks] = None,
=======
        callbacks: Callbacks | None = None,
>>>>>>> 10771d2d (Initial commit for Crean AI Matcher full app)
    ) -> Sequence[Document]:
        """Async compress retrieved documents given the query context.

        Args:
            documents: The retrieved documents.
            query: The query context.
            callbacks: Optional callbacks to run during compression.

        Returns:
            The compressed documents.
<<<<<<< HEAD
=======

>>>>>>> 10771d2d (Initial commit for Crean AI Matcher full app)
        """
        return await run_in_executor(
            None, self.compress_documents, documents, query, callbacks
        )
